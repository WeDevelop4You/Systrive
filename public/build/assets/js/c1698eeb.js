import{C as h,V as c,R as d}from"./8f3521ec.js";import{A as u,D as f}from"./0e939e68.js";import{D as m}from"./ed6ab0a1.js";import{M as r}from"./f72d6ec9.js";import{R as v}from"./23e0ddc0.js";import{m as p,T}from"./e0db1d00.js";import{R as g}from"./0f1ce05e.js";import{j as n,p as a,r as x,q as s}from"./5ecbb865.js";const A=p(f,m,d,v,T,r),O=A.extend({name:"v-menu",directives:{ClickOutside:h,Resize:g},provide(){return{isInMenu:!0,theme:this.theme}},props:{auto:Boolean,closeOnClick:{type:Boolean,default:!0},closeOnContentClick:{type:Boolean,default:!0},disabled:Boolean,disableKeys:Boolean,maxHeight:{type:[Number,String],default:"auto"},offsetX:Boolean,offsetY:Boolean,openOnHover:Boolean,origin:{type:String,default:"top left"},transition:{type:[Boolean,String],default:"v-menu-transition"}},data(){return{calculatedTopAuto:0,defaultOffset:8,hasJustFocused:!1,listIndex:-1,resizeTimeout:0,selectedIndex:null,tiles:[]}},computed:{activeTile(){return this.tiles[this.listIndex]},calculatedLeft(){const t=Math.max(this.dimensions.content.width,parseFloat(this.calculatedMinWidth));return this.auto?n(this.calcXOverflow(this.calcLeftAuto(),t))||"0":this.calcLeft(t)||"0"},calculatedMaxHeight(){return(this.auto?"200px":n(this.maxHeight))||"0"},calculatedMaxWidth(){return n(this.maxWidth)||"0"},calculatedMinWidth(){if(this.minWidth)return n(this.minWidth)||"0";const t=Math.min(this.dimensions.activator.width+Number(this.nudgeWidth)+(this.auto?16:0),Math.max(this.pageWidth-24,0)),e=isNaN(parseInt(this.calculatedMaxWidth))?t:parseInt(this.calculatedMaxWidth);return n(Math.min(e,t))||"0"},calculatedTop(){return(this.auto?n(this.calcYOverflow(this.calculatedTopAuto)):this.calcTop())||"0"},hasClickableTiles(){return Boolean(this.tiles.find(t=>t.tabIndex>-1))},styles(){return{maxHeight:this.calculatedMaxHeight,minWidth:this.calculatedMinWidth,maxWidth:this.calculatedMaxWidth,top:this.calculatedTop,left:this.calculatedLeft,transformOrigin:this.origin,zIndex:this.zIndex||this.activeZIndex}}},watch:{isActive(t){t||(this.listIndex=-1)},isContentActive(t){this.hasJustFocused=t},listIndex(t,e){if(t in this.tiles){const i=this.tiles[t];i.classList.add("v-list-item--highlighted");const o=this.$refs.content.scrollTop,l=this.$refs.content.clientHeight;o>i.offsetTop-8?a(i.offsetTop-i.clientHeight,{appOffset:!1,duration:300,container:this.$refs.content}):o+l<i.offsetTop+i.clientHeight+8&&a(i.offsetTop-l+i.clientHeight*2,{appOffset:!1,duration:300,container:this.$refs.content})}e in this.tiles&&this.tiles[e].classList.remove("v-list-item--highlighted")}},created(){this.$attrs.hasOwnProperty("full-width")&&x("full-width",this)},mounted(){this.isActive&&this.callActivate()},methods:{activate(){this.updateDimensions(),requestAnimationFrame(()=>{this.startTransition().then(()=>{this.$refs.content&&(this.calculatedTopAuto=this.calcTopAuto(),this.auto&&(this.$refs.content.scrollTop=this.calcScrollPosition()))})})},calcScrollPosition(){const t=this.$refs.content,e=t.querySelector(".v-list-item--active"),i=t.scrollHeight-t.offsetHeight;return e?Math.min(i,Math.max(0,e.offsetTop-t.offsetHeight/2+e.offsetHeight/2)):t.scrollTop},calcLeftAuto(){return parseInt(this.dimensions.activator.left-this.defaultOffset*2)},calcTopAuto(){const t=this.$refs.content,e=t.querySelector(".v-list-item--active");if(e||(this.selectedIndex=null),this.offsetY||!e)return this.computedTop;this.selectedIndex=Array.from(this.tiles).indexOf(e);const i=e.offsetTop-this.calcScrollPosition(),o=t.querySelector(".v-list-item").offsetTop;return this.computedTop-i-o-1},changeListIndex(t){if(this.getTiles(),!(!this.isActive||!this.hasClickableTiles)){if(t.keyCode===s.tab){this.isActive=!1;return}else if(t.keyCode===s.down)this.nextTile();else if(t.keyCode===s.up)this.prevTile();else if(t.keyCode===s.end)this.lastTile();else if(t.keyCode===s.home)this.firstTile();else if(t.keyCode===s.enter&&this.listIndex!==-1)this.tiles[this.listIndex].click();else return;t.preventDefault()}},closeConditional(t){const e=t.target;return this.isActive&&!this._isDestroyed&&this.closeOnClick&&!this.$refs.content.contains(e)},genActivatorAttributes(){const t=u.options.methods.genActivatorAttributes.call(this);return this.activeTile&&this.activeTile.id?{...t,"aria-activedescendant":this.activeTile.id}:t},genActivatorListeners(){const t=r.options.methods.genActivatorListeners.call(this);return this.disableKeys||(t.keydown=this.onKeyDown),t},genTransition(){const t=this.genContent();return this.transition?this.$createElement("transition",{props:{name:this.transition}},[t]):t},genDirectives(){const t=[{name:"show",value:this.isContentActive}];return!this.openOnHover&&this.closeOnClick&&t.push({name:"click-outside",value:{handler:()=>{this.isActive=!1},closeConditional:this.closeConditional,include:()=>[this.$el,...this.getOpenDependentElements()]}}),t},genContent(){const t={attrs:{...this.getScopeIdAttrs(),role:"role"in this.$attrs?this.$attrs.role:"menu"},staticClass:"v-menu__content",class:{...this.rootThemeClasses,...this.roundedClasses,"v-menu__content--auto":this.auto,"v-menu__content--fixed":this.activatorFixed,menuable__content__active:this.isActive,[this.contentClass.trim()]:!0},style:this.styles,directives:this.genDirectives(),ref:"content",on:{click:e=>{e.target.getAttribute("disabled")||this.closeOnContentClick&&(this.isActive=!1)},keydown:this.onKeyDown}};return this.$listeners.scroll&&(t.on=t.on||{},t.on.scroll=this.$listeners.scroll),!this.disabled&&this.openOnHover&&(t.on=t.on||{},t.on.mouseenter=this.mouseEnterHandler),this.openOnHover&&(t.on=t.on||{},t.on.mouseleave=this.mouseLeaveHandler),this.$createElement("div",t,this.getContentSlot())},getTiles(){!this.$refs.content||(this.tiles=Array.from(this.$refs.content.querySelectorAll(".v-list-item, .v-divider, .v-subheader")))},mouseEnterHandler(){this.runDelay("open",()=>{this.hasJustFocused||(this.hasJustFocused=!0)})},mouseLeaveHandler(t){this.runDelay("close",()=>{var e;!((e=this.$refs.content)===null||e===void 0)&&e.contains(t.relatedTarget)||requestAnimationFrame(()=>{this.isActive=!1,this.callDeactivate()})})},nextTile(){const t=this.tiles[this.listIndex+1];if(!t){if(!this.tiles.length)return;this.listIndex=-1,this.nextTile();return}this.listIndex++,t.tabIndex===-1&&this.nextTile()},prevTile(){const t=this.tiles[this.listIndex-1];if(!t){if(!this.tiles.length)return;this.listIndex=this.tiles.length,this.prevTile();return}this.listIndex--,t.tabIndex===-1&&this.prevTile()},lastTile(){const t=this.tiles[this.tiles.length-1];!t||(this.listIndex=this.tiles.length-1,t.tabIndex===-1&&this.prevTile())},firstTile(){const t=this.tiles[0];!t||(this.listIndex=0,t.tabIndex===-1&&this.nextTile())},onKeyDown(t){if(t.keyCode===s.esc){setTimeout(()=>{this.isActive=!1});const e=this.getActivator();this.$nextTick(()=>e&&e.focus())}else!this.isActive&&[s.up,s.down].includes(t.keyCode)&&(this.isActive=!0);this.$nextTick(()=>this.changeListIndex(t))},onResize(){!this.isActive||(this.$refs.content.offsetWidth,this.updateDimensions(),clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(this.updateDimensions,100))}},render(t){const e={staticClass:"v-menu",class:{"v-menu--attached":this.attach===""||this.attach===!0||this.attach==="attach"},directives:[{arg:"500",name:"resize",value:this.onResize}]};return t("div",e,[!this.activator&&this.genActivator(),this.showLazyContent(()=>[this.$createElement(c,{props:{root:!0,light:this.light,dark:this.dark}},[this.genTransition()])])])}});export{O as _};
